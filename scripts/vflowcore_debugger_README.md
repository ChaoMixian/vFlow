# vFlowCore 调试工具

## 功能特性

- 📡 **远程连接** - 支持通过网络连接到 vFlowCore（监听 0.0.0.0:19999）
- 🎯 **可视化界面** - tkinter GUI，直观构建和发送请求
- ⚡ **快捷操作** - 预设常用操作按钮，一键执行
- 📝 **实时日志** - 显示通信日志和响应
- 🎨 **JSON 格式化** - 自动格式化响应数据
- 🧪 **自动测试** - 批量测试所有接口，生成测试报告

## 使用方法

### 1. 启动 vFlowCore

在 Android 设备上启动 vFlowCore：
```bash
# 通过 App 界面启动，或使用 adb shell
adb shell sh -c 'export CLASSPATH="/sdcard/vFlow/temp/vFlowCore.dex"; exec app_process /system/bin com.chaomixian.vflow.server.VFlowCore' &
```

### 2. 准备端口转发

如果使用 USB 调试，需要设置端口转发：
```bash
adb forward tcp:19999 tcp:19999
```

如果使用 WiFi 调试（设备 IP 为 192.168.1.100）：
- 确保设备和电脑在同一网络
- 调试工具中设置主机为 192.168.1.100

### 3. 启动调试工具

```bash
python3 vflowcore_debugger.py
```

或直接运行：
```bash
chmod +x vflowcore_debugger.py
./vflowcore_debugger.py
```

### 4. 连接配置

- **主机**：
  - USB 调试：`127.0.0.1`
  - WiFi 调试：设备的 IP 地址
- **端口**：`19999`

点击"连接"按钮建立连接。

### 5. 发送请求

#### 方法一：使用快捷按钮
- 选择 Target
- 点击对应的快捷操作按钮
- 自动填充参数并发送

#### 方法二：手动构建
1. 选择 Target（system、clipboard、input 等）
2. 选择 Method
3. 编辑参数 JSON
4. 点击"发送请求"

### 6. 自动测试（🧪 新功能）

点击"🧪 自动测试"按钮，可以批量测试所有接口：

#### 测试范围选择

弹出的对话框提供三个选项：

- **🟢 安全测试**（2 个测试）
  - ping 测试
  - 获取剪贴板
  - ✅ 无副作用，可安全运行

- **🟡 常规测试**（9 个测试）
  - 包括安全测试
  - 设置剪贴板
  - 开关 WiFi
  - 开关蓝牙
  - 唤醒/关闭屏幕
  - ⚠️ 有副作用，会改变设备状态

- **🔴 完整测试**（13 个测试）
  - 包括常规测试
  - 点击屏幕、滑动
  - 输入文本
  - 强制停止应用
  - ⚠️⚠️ 危险操作，会直接影响设备和应用
  - 💡 适合在模拟器中测试

#### 测试报告

测试完成后会生成详细报告：

**安全测试报告示例**：
```
🧪 vFlowCore 自动测试报告
========================================

测试时间: 14:30:25
总计: 2 个测试
通过: 2 个 ✅
失败: 0 个 ❌
成功率: 100.0%

详细结果:
----------------------------------------

✅ Ping 测试
  响应: {"success": true, "message": "pong", "uid": 2000}

✅ 获取剪贴板
  响应: {"success": true, "text": "Hello"}

========================================
```

**完整测试报告示例**：
```
🧪 vFlowCore 自动测试报告
========================================

测试时间: 14:35:10
总计: 13 个测试
通过: 13 个 ✅
失败: 0 个 ❌
成功率: 100.0%

详细结果:
----------------------------------------

✅ Ping 测试
✅ 获取剪贴板
✅ 设置剪贴板
✅ 开启 WiFi
✅ 关闭 WiFi
✅ 开启蓝牙
✅ 关闭蓝牙
✅ 唤醒屏幕
✅ 关闭屏幕
✅ 点击屏幕
✅ 滑动屏幕
✅ 输入文本
✅ 强制停止应用

========================================
```

#### 实时进度

- 日志区显示实时测试进度
- 响应区显示当前测试的详细信息
- 每个测试间隔 0.2 秒

#### 注意事项

⚠️ **常规测试会影响设备状态**：
- WiFi 和蓝牙会被开关
- 屏幕会被唤醒和关闭
- 剪贴板内容会被修改

⚠️⚠️ **完整测试包括危险操作**：
- 点击屏幕（tap）- 会真的点击屏幕
- 滑动屏幕（swipe）- 会真的滑动
- 输入文本（inputText）- 会真的输入文字
- 强制停止应用（forceStopPackage）- 会杀死应用

💡 **建议**：
- 在真机上：选择"安全测试"或"常规测试"
- 在模拟器上：可以选择"完整测试"

## 支持的操作

### System
- **ping** - 测试连接，返回 UID
- **exit** - 退出 vFlowCore

### Clipboard
- **getClipboard** - 获取剪贴板内容
- **setClipboard** - 设置剪贴板内容
  ```json
  {"text": "Hello World"}
  ```

### Input
- **tap** - 点击屏幕
  ```json
  {"x": 500, "y": 500}
  ```
- **swipe** - 滑动
  ```json
  {"x1": 500, "y1": 500, "x2": 500, "y2": 1000, "duration": 300}
  ```
- **key** - 发送按键码
  ```json
  {"code": 4}  # 4 = BACK 键
  ```
- **inputText** - 输入文本
  ```json
  {"text": "test text"}
  ```

### WiFi
- **setWifiEnabled** - 开关 WiFi
  ```json
  {"enabled": true}
  ```

### Bluetooth
- **setBluetoothEnabled** - 开关蓝牙
  ```json
  {"enabled": true}
  ```

### Power
- **wakeUp** - 唤醒屏幕
- **goToSleep** - 关闭屏幕

### Activity
- **forceStopPackage** - 强制停止应用
  ```json
  {"package": "com.example.app"}
  ```

## 响应格式

成功响应：
```json
{
  "success": true,
  "message": "pong",
  "uid": 0
}
```

失败响应：
```json
{
  "success": false,
  "error": "Service not found"
}
```

## 常见问题

### 连接失败
1. 检查 vFlowCore 是否运行
2. 检查端口转发是否正确（`adb forward tcp:19999 tcp:19999`）
3. 检查防火墙设置

### 无响应
1. 查看 vFlowCore 日志
2. 检查请求格式是否正确
3. 确认当前 Worker 支持该操作

## 示例工作流

### 测试剪贴板功能

1. 启动工具并连接
2. Target 选择 `clipboard`
3. 点击"设置剪贴板"快捷按钮
4. 查看响应结果
5. 点击"获取剪贴板"验证设置成功

### 模拟输入操作

1. Target 选择 `input`
2. Method 选择 `inputText`
3. 参数填写：
   ```json
   {"text": "Hello from debugger!"}
   ```
4. 点击"发送请求"

### 控制设备电源

1. Target 选择 `power`
2. 点击"唤醒屏幕"或"关闭屏幕"
3. 观察设备响应

## 技术细节

### vFlowCore 配置
- 监听地址：`0.0.0.0`（允许所有网卡）
- 监听端口：`19999`
- 超时时间：10000ms

### 通信协议
- 格式：JSON 字符串 + `\n`
- 方向：客户端 → vFlowCore
- 示例：
  ```json
  {"target":"system","method":"ping","params":{}}
  ```

## 更新日志

### v1.1 (最新)
- ✨ 新增自动测试功能
- ✨ 新增测试报告生成
- ✨ 新增测试范围选择（安全/完整）
- ✨ 新增实时测试进度显示
- ✨ 新增成功率统计
- ✨ 自动跳过危险操作（点击、输入、杀死应用）

### v1.0
- 初始版本
- 支持 7 个 Target 的调试
- 快捷操作按钮
- 实时日志显示
